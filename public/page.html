<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <link href="css/page.css" rel="stylesheet">
    </head>
        
    <body>

        <div id="blocks">
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function(){
                var path = window.location.pathname;
                var pretty_title = path.slice(1);
                // var titleEl = document.getElementById('title');
                // titleEl.innerHTML = pretty_title;
                document.title = pretty_title;

                fetch('/api' + path)
                .then(response => response.json())
                .then(data => {
                    // console.log(data);
                    var head = document.getElementsByTagName('head');
                    var title = document.getElementById('title');
                    var blocks = document.getElementById('blocks');

                    data.map((item) => {
                        var div = document.createElement("div");
                        console.log(item);

                        if (item.class == 'Text') {
                            console.log('text');
                            div.classList.add("text");
                            div.innerHTML = `
                                ${item.content_html}
                            `;
                        } else if (item.class == 'Link') {
                            console.log('link');
                            div.classList.add("link");
                            div.innerHTML = `
                                <a href="${item.source.url}">${item.source.url}</a>
                            `;
                        } else if (item.class == 'Image') {
                            console.log('image');
                            div.classList.add("image");
                            div.innerHTML = `
                                <figure><img src="${item.image.large.url}"/></figure>
                                <caption>${item.content}</caption>
                            `;
                        } else if (item.class == 'Attachment') {
                            console.log('attachment');
                            if (item.attachment.content_type == 'video/mp4') {
                                div.classList.add("video");
                                div.innerHTML = `
                                    <video controls>
                                        <source src="${item.attachment.url}" type="video/mp4">
                                    </video>
                                `;
                            }
                        }

                        if (item.title == 'stylesheet') {
                            var css = item.content,
                                head = document.head || document.getElementsByTagName('head')[0],
                                style = document.createElement('style');

                            head.appendChild(style);

                            style.type = 'text/css';
                            if (style.styleSheet){
                                // This is required for IE8 and below.
                                style.styleSheet.cssText = css;
                            } else {
                                style.appendChild(document.createTextNode(css));
                            }
                        } else {
                            blocks.appendChild(div);
                        }
                    });
                })
                .catch(error => console.error(error))

            });
        </script>

    </body>
</html>